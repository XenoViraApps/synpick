# Dockerfile for testing global installation with root permissions
FROM node:22-slim

# Set environment variables
ENV NODE_ENV=development
ENV NPM_CONFIG_LOGLEVEL=warn
ENV NPM_CONFIG_PROGRESS=false
ENV DEBIAN_FRONTEND=noninteractive

# Install utilities
RUN apt-get update && apt-get install -y \
    curl \
    wget \
    bash \
    && rm -rf /var/lib/apt/lists/*

# Create test directory
WORKDIR /app

# Copy the synclaude source to container
COPY . /app/synclaude
WORKDIR /app/synclaude

# Install dependencies globally with root permissions
RUN npm install --include=dev
RUN npm run build
RUN npm install -g .

# Test the installation
RUN which synclaude
RUN synclaude --version

# Test module resolution
RUN node -e "console.log('Testing ink...'); require('ink'); console.log('✓ ink OK');"
RUN node -e "console.log('Testing chalk...'); require('chalk'); console.log('✓ chalk OK');"

CMD ["/bin/bash"]